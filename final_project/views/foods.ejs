<head>
<link rel="stylesheet" type="text/css" href="/stylesheets/style.css">
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script src="http://underscorejs.org/underscore.js"></script>
<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/pure-min.css">
</head>
<body>
<p>Showing food list for <%= user.first + user.last %></p>
<a href='/<%= user.slug %>'>Back</a></br>
<a href='/logout'>Log out</a></br>

<div class="allFoods"></div>
</br>

<form id="foodInfo" class="pure-form">
	<div class="pieChart"></div>
	<input type="hidden" name="chosenFood" id="chosenFood"></input>
	<input type="hidden" id="csrf" name="_csrf" value="<%= csrfToken %>">
	<input type="text" name="Amount" placeholder="New amount"></input>
</form>

<script src="/javascript/GoogleTable.js"></script>
<script src="/javascript/GooglePie.js"></script>
<script src="/javascript/foodConfig.js"></script>
<script>
	var myPieChart = new GooglePie()
	var charts = <%- JSON.stringify(chartData) %>
	var $allFoods = $('.allFoods')
	var csrf = $('#csrf').val()

	var allTables = []
	for (var i = 0; i < charts.length; i++) {
		var classname = 'foodChart' + i
		var fullClass = "<div class ='" + classname + "' 'googleTable'>"
		$allFoods.append($(fullClass))
		
		function tableHandler(e) {
			var rowIndex = thisTable.getSelectedRow()
			var rows = []
			for (var i = 0; i < map.length; i++) {
				rows[i] = [nutrition[i], parseFloat(thisTable.getValue(rowIndex, map[i]))]
			}

			var id = thisTable.getValue(rowIndex, fields.length - 1)
			$('#chosenFood').val(id)

			myPieChart.googlePieDraw(rows)
		};

		var thisTable = new GoogleTable('.'+classname, charts[i], tableHandler, foodTableOptions)
	}

	var userSlug = '<%= user.slug %>'

	$('#foodInfo').on('submit', function(e){
		e.preventDefault()
		$.ajax({
			type: 'PUT',
			url: ('/' + userSlug + '/foods'),
			data: {
				hi: '2',
				_csrf: csrf
			},
			success: function(d) {
				console.log(d)
			}
		})
	})
</script>
</body>